<!DOCTYPE html>
<html lang="en">

<head>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>AzPam 0.0.1</title>
		<link type="text/css" href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link type="text/css" href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link type="text/css" href="css/theme.css" rel="stylesheet">
		<link type="text/css" href="images/icons/css/font-awesome.css" rel="stylesheet">
		<link type="text/css" href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600'
			rel='stylesheet'>
	</head>

<body>
	<div class="wrapper">
		<div class="container">
			<div class="row">
				<div class="span3">
					<div class="sidebar">
						<ul class="widget widget-menu unstyled">
							<li class="active"><a href="index.html"><i class="menu-icon icon-dashboard"></i>Dashboard
								</a></li>
							<li><a href="NewRequest.html"><i class="menu-icon icon-bullhorn"></i>New Account Request
								</a>
							</li>
							<li><a href="OpenRequests.html"><i class="menu-icon icon-inbox"></i>Open Requests <b
										class="label green pull-right">
										11</b> </a></li>
							<li><a href="AccountManagement.html"><i class="menu-icon icon-tasks"></i>Account Management
									<b class="label orange pull-right">
										19</b> </a></li>
						</ul>
						<!--/.widget-nav-->


						<ul class="widget widget-menu unstyled">
							<li><a class="collapsed" data-toggle="collapse" href="#togglePages"><i
										class="menu-icon icon-cog">
									</i><i class="icon-chevron-down pull-right"></i><i
										class="icon-chevron-up pull-right">
									</i>Settings </a>
								<ul id="togglePages" class="collapse unstyled">
									<li><a href="other-login.html"><i class="icon-inbox"></i>Azure Function </a></li>
									<li><a href="other-user-profile.html"><i class="icon-inbox"></i>Keyvault </a></li>
									<li><a href="other-user-listing.html"><i class="icon-inbox"></i> API Keys </a></li>
								</ul>
							</li>
							<li><a href="#"><i class="menu-icon icon-signout"></i>Logout </a></li>
						</ul>
					</div>
					<!--/.sidebar-->
				</div>
				<!--/.span3-->
				<div class="span9">
					<div class="content">

						<div class="module">
							<div class="module-head">
								<h3>Forms</h3>
							</div>
							<div class="module-body">
								<br />

								<form id='NewRequest' method="POST" action=Approvalrequest class="form-horizontal row-fluid">
									<div class="control-group">
										<label class="control-label" for="basicinput">Request Name</label>
										<div class="controls">
											<input type="text" id="basicinput" name="RequestName" placeholder="Type something here..."
												class="span8">
											<span class="help-inline">Minimum 5 Characters</span>
										</div>
									</div>
									<form class="form-horizontal row-fluid">
										<div class="control-group">
											<label class="control-label" for="basicinput">Prefered username</label>
											<div class="controls">
												<input type="text" name="RequestedUsername" id="basicinput"
													placeholder="Username will be appended with random characters automatically."
													class="span8">
												<span class="help-inline">Minimum 5 Characters</span>
											</div>
										</div>

										<div class="control-group">
											<label class="control-label" for="basicinput">Request Type</label>
											<div class="controls">
												<select tabindex="1" name="RequestType" data-placeholder="Select here.." class="span8">
													<option value="O365">Office 365 / Azure AD</option>
													<option value="Local">Workstation / Server Account</option>
												</select>
											</div>
										</div>

										<div class="control-group">
											<label class="control-label" for="basicinput">Request Role</label>
											<div class="controls">
												<select tabindex="1" name='RequestedRole' data-placeholder="Select here.."
													class="span8">
													<option value="62e90394-69f5-4237-9190-012177145e10">Global
														Administrator / Company Administrator</option>
													<option value="Ladmin">Local Administrator</option>
													<option value="DAdmin">Domain Administrator</option>
												</select>
											</div>
										</div>


										<div class="control-group">
											<label class="control-label" for="basicinput">Request Tenant</label>
											<div class="controls">
												<select tabindex="1" id='tenant' name="RequestTenant" data-placeholder="Select here.."
													class="span8">

												</select>
											</div>
										</div>

										<div class="control-group">
											<label class="control-label" for="basicinput">Expires</label>
											<div class="controls">
												<select tabindex="1" name="RequestedExpireDate" data-placeholder="Select here.." class="span8">
													<option value="1">1 day after approval </option>
													<option value="2">2 days after approval</option>
													<option value="3">3 days after approval</option>
													<option value="4">4 days after approval</option>
													<option value="5">5 days after approval</option>
													<option value="6">6 days after approval</option>
													<option value="7">7 days after approval</option>
													<option value="14">14 days after approval</option>
													<option value="28">28 days after approval</option>
													<option value="0">Never</option>
												</select>
											</div>
										</div>


										<div class="control-group">
											<label class="control-label" for="basicinput">Reason for request</label>
											<div class="controls">
												<textarea class="span8" name="RequestedReason" rows="5"></textarea>
											</div>
										</div>

										<div class="control-group">
											<div class="controls">
												<button type="submit" class="btn">Submit Request</button>
											</div>
										</div>
									</form>
									
							</div>
						</div>



					</div>
					<!--/.content-->
				</div>
				<!--/.span9-->
			</div>
		</div>
		<!--/.container-->
	</div>
	<!--/.wrapper-->
	<div class="footer">
		<div class="container">
			<b class="copyright">&copy; 2014 Edmin - EGrappler.com </b>All rights reserved.
		</div>
	</div>
	<script src="scripts/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="scripts/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
	<script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="scripts/flot/jquery.flot.js" type="text/javascript"></script>
	<script src="scripts/flot/jquery.flot.resize.js" type="text/javascript"></script>
	<script src="scripts/datatables/jquery.dataTables.js" type="text/javascript"></script>
	<script>
		(async function () {
			var jsonresult = await (await fetch(`GetAzPamTable?Table=Tenants`)).json();
			var selectlist = document.getElementById('tenant');
			jsonresult.forEach(function (object) {
				selectlist.options[selectlist.options.length] = new Option(object.TenantID + "(" + object.Type + ")", object.TenantID)
			});
		}());
function getFormData($form){
	var unindexed_array = $form.serializeArray();
	var indexed_array = {};

	$.map(unindexed_array, function(n, i){
		indexed_array[n['name']] = n['value'];
	});

	return indexed_array;
}
		window.addEventListener("load", function () {
			function sendData() {
				const XHR = new XMLHttpRequest();

				// Bind the FormData object and the form element
				var Myform = $("#NewRequest");
				var FDObj = getFormData(Myform);
				var FD = JSON.stringify(FDObj);
				// Define what happens on successful data submission
				XHR.addEventListener("load", function (event) {
					alert(event.target.responseText);
				});

				// Define what happens in case of error
				XHR.addEventListener("error", function (event) {
					alert('Oops! Something went wrong.');
				});

				// Set up our request
				XHR.open("POST", "/Approvalrequest");

				// The data sent is what the user provided in the form
				XHR.send(FD);
			}

			// Access the form element...
			const form = document.getElementById("NewRequest");

			// ...and take over its submit event.
			form.addEventListener("submit", function (event) {
				event.preventDefault();

				sendData();
			});
		});
	</script>
</body>